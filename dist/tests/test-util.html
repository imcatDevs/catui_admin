<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Util ìœ í‹¸ë¦¬í‹° í…ŒìŠ¤íŠ¸ - Catui</title>
  <link rel="stylesheet" href="../catui.css">
  <style>
    body { padding: 20px; background: #f0f2f5; }
    h2 { margin-bottom: 20px; }
    .test-section { padding: 20px; margin-bottom: 20px; background: #fff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .test-section h3 { margin: 0 0 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; font-size: 16px; }
    .test-section h4 { margin: 15px 0 10px; font-size: 14px; color: #666; }
    .demo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
    .demo-item { padding: 12px; background: #fafafa; border-radius: 4px; }
    .demo-item label { display: block; margin-bottom: 5px; font-size: 12px; color: #999; }
    .demo-item .value { font-size: 14px; color: #333; word-break: break-all; }
    .demo-item .value.success { color: #52c41a; }
    .demo-item .value.error { color: #ff4d4f; }
    .code-block { background: #282c34; color: #abb2bf; padding: 15px; border-radius: 4px; margin-top: 10px; font-family: 'Consolas', monospace; font-size: 12px; overflow-x: auto; white-space: pre; }
    .result-box { padding: 12px; background: #f5f5f5; border-radius: 4px; margin-top: 10px; font-size: 13px; }
    .control-panel { margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap; }
    .countdown-display { font-size: 32px; font-weight: bold; color: #1677ff; text-align: center; padding: 15px; background: #f0f5ff; border-radius: 8px; }
    .test-input { padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; }
    .test-input:focus { border-color: #16b777; outline: none; }
    .inline-result { display: inline-block; padding: 4px 8px; background: #e6f7ff; border-radius: 4px; margin-left: 10px; }
    .countup-box { font-size: 48px; font-weight: bold; color: #16b777; text-align: center; padding: 20px; }
  </style>
</head>
<body>
  <h2>Util ìœ í‹¸ë¦¬í‹° - ì „ì²´ í…ŒìŠ¤íŠ¸</h2>

  <!-- 1. ì‹œê°„/ë‚ ì§œ -->
  <div class="test-section">
    <h3>ğŸ“… ì‹œê°„/ë‚ ì§œ ìœ í‹¸ë¦¬í‹°</h3>
    
    <h4>timeAgo (ê²½ê³¼ ì‹œê°„)</h4>
    <div class="demo-grid">
      <div class="demo-item"><label>30ì´ˆ ì „</label><div class="value" id="timeAgo1"></div></div>
      <div class="demo-item"><label>5ë¶„ ì „</label><div class="value" id="timeAgo2"></div></div>
      <div class="demo-item"><label>3ì‹œê°„ ì „</label><div class="value" id="timeAgo3"></div></div>
      <div class="demo-item"><label>2ì¼ ì „</label><div class="value" id="timeAgo4"></div></div>
      <div class="demo-item"><label>30ì¼ ì „</label><div class="value" id="timeAgo5"></div></div>
    </div>

    <h4>toDateString (ë‚ ì§œ í¬ë§·)</h4>
    <div class="demo-grid">
      <div class="demo-item"><label>yyyy-MM-dd</label><div class="value" id="dateStr1"></div></div>
      <div class="demo-item"><label>yyyy/MM/dd HH:mm</label><div class="value" id="dateStr2"></div></div>
      <div class="demo-item"><label>yyë…„ Mì›” dì¼</label><div class="value" id="dateStr3"></div></div>
    </div>

    <h4>countdown (ì¹´ìš´íŠ¸ë‹¤ìš´)</h4>
    <div class="demo-grid">
      <div class="demo-item" style="grid-column: span 2;">
        <label>30ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´</label>
        <div class="countdown-display" id="countdown1">00:30</div>
      </div>
    </div>
    <div class="control-panel">
      <button class="cui-btn cui-btn-sm cui-btn-primary" onclick="startCountdown()">ì‹œì‘</button>
      <button class="cui-btn cui-btn-sm" onclick="resetCountdown()">ë¦¬ì…‹</button>
    </div>
  </div>

  <!-- 2. ìˆ«ì -->
  <div class="test-section">
    <h3>ğŸ”¢ ìˆ«ì ìœ í‹¸ë¦¬í‹°</h3>
    
    <h4>comma (ì²œë‹¨ìœ„ ì½¤ë§ˆ)</h4>
    <div class="demo-grid">
      <div class="demo-item"><label>1234567</label><div class="value" id="comma1"></div></div>
      <div class="demo-item"><label>9876543.21</label><div class="value" id="comma2"></div></div>
    </div>

    <h4>digit (ìë¦¿ìˆ˜ ì±„ìš°ê¸°)</h4>
    <div class="demo-grid">
      <div class="demo-item"><label>digit(5)</label><div class="value" id="digit1"></div></div>
      <div class="demo-item"><label>digit(12)</label><div class="value" id="digit2"></div></div>
      <div class="demo-item"><label>digit(7, 3)</label><div class="value" id="digit3"></div></div>
    </div>

    <h4>countUp (ìˆ«ì ì• ë‹ˆë©”ì´ì…˜)</h4>
    <div class="demo-grid">
      <div class="demo-item" style="grid-column: span 2;">
        <div class="countup-box" id="countup1">0</div>
      </div>
    </div>
    <div class="control-panel">
      <button class="cui-btn cui-btn-sm cui-btn-primary" onclick="runCountUp()">ì¹´ìš´íŠ¸ì—… ì‹œì‘</button>
    </div>
  </div>

  <!-- 3. ë¬¸ìì—´ -->
  <div class="test-section">
    <h3>ğŸ“ ë¬¸ìì—´ ìœ í‹¸ë¦¬í‹°</h3>
    
    <h4>escape / unescape (HTML ì´ìŠ¤ì¼€ì´í”„)</h4>
    <div class="result-box" id="escapeResult"></div>

    <h4>stripScripts (ìŠ¤í¬ë¦½íŠ¸ ì œê±°)</h4>
    <div class="result-box" id="stripResult"></div>

    <h4>sanitize (HTML ì •í™”)</h4>
    <div class="result-box" id="sanitizeResult"></div>
  </div>

  <!-- 4. ë³´ì•ˆ -->
  <div class="test-section">
    <h3>ğŸ”’ ë³´ì•ˆ ìœ í‹¸ë¦¬í‹°</h3>
    
    <h4>escapeSql (SQL ì¸ì ì…˜ ë°©ì§€)</h4>
    <div class="result-box" id="sqlResult"></div>

    <h4>escapeRegex (ì •ê·œì‹ ì´ìŠ¤ì¼€ì´í”„)</h4>
    <div class="result-box" id="regexResult"></div>

    <h4>safeJsonParse (ì•ˆì „í•œ JSON íŒŒì‹±)</h4>
    <div class="result-box" id="jsonResult"></div>

    <h4>safeEncodeUri (URL ì¸ì½”ë”©)</h4>
    <div class="result-box" id="uriResult"></div>
  </div>

  <!-- 5. ê²€ì¦ -->
  <div class="test-section">
    <h3>âœ… ê²€ì¦ ìœ í‹¸ë¦¬í‹°</h3>
    
    <h4>isEmpty (ë¹ˆê°’ ì²´í¬)</h4>
    <div class="demo-grid">
      <div class="demo-item"><label>isEmpty('')</label><div class="value" id="empty1"></div></div>
      <div class="demo-item"><label>isEmpty([])</label><div class="value" id="empty2"></div></div>
      <div class="demo-item"><label>isEmpty({})</label><div class="value" id="empty3"></div></div>
      <div class="demo-item"><label>isEmpty('hello')</label><div class="value" id="empty4"></div></div>
    </div>

    <h4>isEmail / isPhone / isUrl</h4>
    <div class="demo-grid">
      <div class="demo-item"><label>isEmail('test@test.com')</label><div class="value" id="valid1"></div></div>
      <div class="demo-item"><label>isEmail('invalid')</label><div class="value" id="valid2"></div></div>
      <div class="demo-item"><label>isPhone('010-1234-5678')</label><div class="value" id="valid3"></div></div>
      <div class="demo-item"><label>isUrl('https://example.com')</label><div class="value" id="valid4"></div></div>
    </div>
  </div>

  <!-- 6. ID ìƒì„± -->
  <div class="test-section">
    <h3>ğŸ†” ID ìƒì„±</h3>
    <div class="demo-grid">
      <div class="demo-item" style="grid-column: span 2;"><label>uuid()</label><div class="value" id="uuid1"></div></div>
      <div class="demo-item"><label>shortId()</label><div class="value" id="shortId1"></div></div>
      <div class="demo-item"><label>shortId(12)</label><div class="value" id="shortId2"></div></div>
    </div>
    <div class="control-panel">
      <button class="cui-btn cui-btn-sm cui-btn-primary" onclick="regenerateIds()">ë‹¤ì‹œ ìƒì„±</button>
    </div>
  </div>

  <!-- 7. URL/ì¿¼ë¦¬ -->
  <div class="test-section">
    <h3>ğŸ”— URL/ì¿¼ë¦¬ìŠ¤íŠ¸ë§</h3>
    
    <h4>parseQuery / toQuery</h4>
    <div class="result-box" id="queryResult"></div>
  </div>

  <!-- 8. ì¿ í‚¤ -->
  <div class="test-section">
    <h3>ğŸª ì¿ í‚¤ ê´€ë¦¬</h3>
    <div class="control-panel">
      <input type="text" class="test-input" id="cookieKey" placeholder="í‚¤" value="testCookie">
      <input type="text" class="test-input" id="cookieValue" placeholder="ê°’" value="Hello World">
      <button class="cui-btn cui-btn-sm cui-btn-primary" onclick="setCookieTest()">ì €ì¥</button>
      <button class="cui-btn cui-btn-sm" onclick="getCookieTest()">ì½ê¸°</button>
      <button class="cui-btn cui-btn-sm cui-btn-danger" onclick="removeCookieTest()">ì‚­ì œ</button>
    </div>
    <div class="result-box" id="cookieResult">ì¿ í‚¤ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>

  <!-- 9. í•¨ìˆ˜ ìœ í‹¸ -->
  <div class="test-section">
    <h3>âš¡ í•¨ìˆ˜ ìœ í‹¸ë¦¬í‹°</h3>
    
    <h4>debounce / throttle</h4>
    <div class="control-panel">
      <button class="cui-btn cui-btn-sm" id="debounceBtn">Debounce í…ŒìŠ¤íŠ¸ (ì—°íƒ€í•´ë³´ì„¸ìš”)</button>
      <button class="cui-btn cui-btn-sm" id="throttleBtn">Throttle í…ŒìŠ¤íŠ¸ (ì—°íƒ€í•´ë³´ì„¸ìš”)</button>
    </div>
    <div class="result-box" id="funcResult">ë²„íŠ¼ì„ ì—°ì†ìœ¼ë¡œ í´ë¦­í•´ë³´ì„¸ìš”.</div>

    <h4>deepClone (ê¹Šì€ ë³µì‚¬)</h4>
    <div class="result-box" id="cloneResult"></div>
  </div>

  <!-- 10. ê¸°íƒ€ -->
  <div class="test-section">
    <h3>ğŸ› ï¸ ê¸°íƒ€ ìœ í‹¸ë¦¬í‹°</h3>
    
    <h4>scrollTo (ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜)</h4>
    <div class="control-panel">
      <button class="cui-btn cui-btn-sm cui-btn-primary" onclick="Catui.util.scrollTo(0, 500)">ë§¨ ìœ„ë¡œ</button>
      <button class="cui-btn cui-btn-sm" onclick="Catui.util.scrollTo(document.body.scrollHeight, 500)">ë§¨ ì•„ë˜ë¡œ</button>
    </div>

    <h4>fixbar (ê³ ì • ë°”)</h4>
    <div class="control-panel">
      <button class="cui-btn cui-btn-sm cui-btn-primary" onclick="showFixbar()">Fixbar í‘œì‹œ</button>
      <button class="cui-btn cui-btn-sm cui-btn-danger" onclick="hideFixbar()">Fixbar ìˆ¨ê¸°ê¸°</button>
    </div>

    <h4>device ì •ë³´</h4>
    <div class="result-box" id="deviceInfo"></div>
  </div>

  <div style="height: 100px;"></div>

  <script src="../catui.js"></script>
  <script>
    var countdownTimer;
    var debounceCount = 0, throttleCount = 0;

    Catui.use(['$c', 'util', 'popup'], function(){
      var util = Catui.util;
      var $c = Catui.$c;

      // 1. ì‹œê°„/ë‚ ì§œ
      document.getElementById('timeAgo1').textContent = util.timeAgo(Date.now() - 30 * 1000);
      document.getElementById('timeAgo2').textContent = util.timeAgo(Date.now() - 5 * 60 * 1000);
      document.getElementById('timeAgo3').textContent = util.timeAgo(Date.now() - 3 * 60 * 60 * 1000);
      document.getElementById('timeAgo4').textContent = util.timeAgo(Date.now() - 2 * 24 * 60 * 60 * 1000);
      document.getElementById('timeAgo5').textContent = util.timeAgo(Date.now() - 30 * 24 * 60 * 60 * 1000);

      document.getElementById('dateStr1').textContent = util.toDateString(Date.now(), 'yyyy-MM-dd');
      document.getElementById('dateStr2').textContent = util.toDateString(Date.now(), 'yyyy/MM/dd HH:mm');
      document.getElementById('dateStr3').textContent = util.toDateString(Date.now(), 'yyë…„ Mì›” dì¼');

      startCountdown();

      // 2. ìˆ«ì
      document.getElementById('comma1').textContent = util.comma(1234567);
      document.getElementById('comma2').textContent = util.comma(9876543.21);
      document.getElementById('digit1').textContent = '"' + util.digit(5) + '"';
      document.getElementById('digit2').textContent = '"' + util.digit(12) + '"';
      document.getElementById('digit3').textContent = '"' + util.digit(7, 3) + '"';

      // 3. ë¬¸ìì—´
      var htmlStr = '<scr' + 'ipt>alert("XSS")</scr' + 'ipt>';
      var escaped = util.escape(htmlStr);
      var escapedDisplay = escaped.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      document.getElementById('escapeResult').innerHTML = 
        '<b>ì›ë³¸:</b> <code>' + htmlStr.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</code><br>' +
        '<b>escape:</b> <code>' + escapedDisplay + '</code><br>' +
        '<b>unescape:</b> <code>' + util.unescape(escaped).replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</code>';

      var xssStr = '<div onC' + 'lick="alert(1)"><ScR' + 'iPt>bad()</sCri' + 'Pt>ì•ˆì „í•œ í…ìŠ¤íŠ¸</div>';
      var stripped = util.stripScripts(xssStr);
      document.getElementById('stripResult').innerHTML = 
        '<b>ì›ë³¸:</b> <code>' + xssStr.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</code><br>' +
        '<b>ê²°ê³¼:</b> <code>' + stripped.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</code>';

      var dirtyHtml = '<div><b>êµµê²Œ</b><img src="x" one' + 'rror="alert(1)"><a href="java' + 'script:void(0)">ë§í¬</a></div>';
      var sanitized = util.sanitize(dirtyHtml);
      document.getElementById('sanitizeResult').innerHTML = 
        '<b>ì›ë³¸:</b> <code>' + dirtyHtml.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</code><br>' +
        '<b>ê²°ê³¼:</b> <code>' + sanitized.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</code>';

      // 4. ë³´ì•ˆ
      var sqlStr = "'; DROP TABLE users; --";
      document.getElementById('sqlResult').innerHTML = 
        '<b>ì›ë³¸:</b> <code>' + sqlStr + '</code><br>' +
        '<b>ê²°ê³¼:</b> <code>' + util.escapeSql(sqlStr) + '</code>';

      var regexStr = "test.*[0-9]+";
      document.getElementById('regexResult').innerHTML = 
        '<b>ì›ë³¸:</b> <code>' + regexStr + '</code><br>' +
        '<b>ê²°ê³¼:</b> <code>' + util.escapeRegex(regexStr) + '</code>';

      document.getElementById('jsonResult').innerHTML = 
        '<b>ìœ íš¨í•œ JSON:</b> <code>util.safeJsonParse(\'{"a":1}\')</code> â†’ ' + JSON.stringify(util.safeJsonParse('{"a":1}')) + '<br>' +
        '<b>ì˜ëª»ëœ JSON:</b> <code>util.safeJsonParse(\'invalid\', {})</code> â†’ ' + JSON.stringify(util.safeJsonParse('invalid', {}));

      var uriStr = "hello world!@#$%";
      document.getElementById('uriResult').innerHTML = 
        '<b>ì›ë³¸:</b> <code>' + uriStr + '</code><br>' +
        '<b>ê²°ê³¼:</b> <code>' + util.safeEncodeUri(uriStr) + '</code>';

      // 5. ê²€ì¦
      document.getElementById('empty1').textContent = String(util.isEmpty(''));
      document.getElementById('empty2').textContent = String(util.isEmpty([]));
      document.getElementById('empty3').textContent = String(util.isEmpty({}));
      document.getElementById('empty4').textContent = String(util.isEmpty('hello'));
      document.getElementById('empty1').className = 'value ' + (util.isEmpty('') ? 'success' : 'error');
      document.getElementById('empty2').className = 'value ' + (util.isEmpty([]) ? 'success' : 'error');
      document.getElementById('empty3').className = 'value ' + (util.isEmpty({}) ? 'success' : 'error');
      document.getElementById('empty4').className = 'value ' + (!util.isEmpty('hello') ? 'success' : 'error');

      document.getElementById('valid1').textContent = String(util.isEmail('test@test.com'));
      document.getElementById('valid2').textContent = String(util.isEmail('invalid'));
      document.getElementById('valid3').textContent = String(util.isPhone('010-1234-5678'));
      document.getElementById('valid4').textContent = String(util.isUrl('https://example.com'));
      document.getElementById('valid1').className = 'value success';
      document.getElementById('valid2').className = 'value error';
      document.getElementById('valid3').className = 'value success';
      document.getElementById('valid4').className = 'value success';

      // 6. ID ìƒì„±
      regenerateIds();

      // 7. URL/ì¿¼ë¦¬
      var queryObj = { name: 'í™ê¸¸ë™', age: 30, city: 'Seoul' };
      var queryStr = util.toQuery(queryObj);
      var parsed = util.parseQuery('?' + queryStr);
      document.getElementById('queryResult').innerHTML = 
        '<b>ê°ì²´:</b> <code>' + JSON.stringify(queryObj) + '</code><br>' +
        '<b>toQuery:</b> <code>' + queryStr + '</code><br>' +
        '<b>parseQuery:</b> <code>' + JSON.stringify(parsed) + '</code>';

      // 9. í•¨ìˆ˜ ìœ í‹¸
      var debouncedFn = util.debounce(function(){
        debounceCount++;
        document.getElementById('funcResult').innerHTML = 
          '<b>Debounce:</b> ì‹¤í–‰ë¨ (' + debounceCount + 'íšŒ)<br>' +
          '<b>Throttle:</b> ' + throttleCount + 'íšŒ';
      }, 500);

      var throttledFn = util.throttle(function(){
        throttleCount++;
        document.getElementById('funcResult').innerHTML = 
          '<b>Debounce:</b> ' + debounceCount + 'íšŒ<br>' +
          '<b>Throttle:</b> ì‹¤í–‰ë¨ (' + throttleCount + 'íšŒ)';
      }, 500);

      document.getElementById('debounceBtn').addEventListener('click', debouncedFn);
      document.getElementById('throttleBtn').addEventListener('click', throttledFn);

      var original = { a: 1, b: { c: 2, d: [3, 4] } };
      var cloned = util.deepClone(original);
      cloned.b.c = 999;
      document.getElementById('cloneResult').innerHTML = 
        '<b>ì›ë³¸:</b> <code>' + JSON.stringify(original) + '</code><br>' +
        '<b>ë³µì‚¬ í›„ ìˆ˜ì •:</b> <code>' + JSON.stringify(cloned) + '</code><br>' +
        '<b>ì›ë³¸ ìœ ì§€ í™•ì¸:</b> ' + (original.b.c === 2 ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨');

      // 10. ê¸°íƒ€
      var device = Catui.device();
      document.getElementById('deviceInfo').innerHTML = 
        '<b>OS:</b> ' + (device.os || 'unknown') + '<br>' +
        '<b>IE:</b> ' + (device.ie || 'false') + '<br>' +
        '<b>Mobile:</b> ' + (device.android || device.ios ? 'Yes' : 'No');
    });

    function startCountdown(){
      var util = Catui.util;
      if(countdownTimer) clearInterval(countdownTimer);
      var endTime = Date.now() + 30 * 1000;
      countdownTimer = util.countdown(endTime, function(d, h, m, s, status){
        var el = document.getElementById('countdown1');
        if(status === 'end'){
          el.textContent = 'ì¢…ë£Œ!';
          el.style.color = '#ff4d4f';
        } else {
          el.textContent = util.digit(m) + ':' + util.digit(s);
          el.style.color = '#1677ff';
        }
      });
    }

    function resetCountdown(){
      startCountdown();
      Catui.popup.msg('ì¹´ìš´íŠ¸ë‹¤ìš´ ë¦¬ì…‹');
    }

    function runCountUp(){
      Catui.util.countUp({
        elem: '#countup1',
        start: 0,
        end: 12345,
        duration: 2000,
        separator: ',',
        prefix: 'â‚©',
        callback: function(){ Catui.popup.msg('ì¹´ìš´íŠ¸ì—… ì™„ë£Œ!'); }
      });
    }

    function regenerateIds(){
      document.getElementById('uuid1').textContent = Catui.util.uuid();
      document.getElementById('shortId1').textContent = Catui.util.shortId();
      document.getElementById('shortId2').textContent = Catui.util.shortId(12);
    }

    function setCookieTest(){
      var key = document.getElementById('cookieKey').value;
      var value = document.getElementById('cookieValue').value;
      Catui.util.setCookie(key, value, 1);
      document.getElementById('cookieResult').innerHTML = 'âœ… ì¿ í‚¤ ì €ì¥ë¨: <b>' + key + '</b> = ' + value;
    }

    function getCookieTest(){
      var key = document.getElementById('cookieKey').value;
      var value = Catui.util.getCookie(key);
      document.getElementById('cookieResult').innerHTML = value 
        ? 'ğŸ“– ì¿ í‚¤ ê°’: <b>' + key + '</b> = ' + value 
        : 'âŒ ì¿ í‚¤ ì—†ìŒ: ' + key;
    }

    function removeCookieTest(){
      var key = document.getElementById('cookieKey').value;
      Catui.util.removeCookie(key);
      document.getElementById('cookieResult').innerHTML = 'ğŸ—‘ï¸ ì¿ í‚¤ ì‚­ì œë¨: <b>' + key + '</b>';
    }

    function showFixbar(){
      Catui.util.fixbar({
        bar1: true,
        bar2: true,
        click: function(type){
          Catui.popup.msg(type + ' í´ë¦­ë¨');
        }
      });
    }

    function hideFixbar(){
      var fixbar = document.querySelector('.cui-fixbar');
      if(fixbar) fixbar.remove();
      Catui.popup.msg('Fixbar ìˆ¨ê¹€');
    }
  </script>
</body>
</html>
