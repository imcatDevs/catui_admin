<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>tpl 템플릿 테스트</title>
  <link rel="stylesheet" href="../catui.css">
  <style>
    body { padding: 20px; font-family: 'Pretendard', sans-serif; background: #f5f5f5; }
    h2 { margin-bottom: 20px; }
    h3 { margin: 25px 0 15px; color: #333; }
    section { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
    .test-result { padding: 15px; background: #fafafa; border-radius: 4px; border: 1px solid #eee; }
    .test-pass { color: #16b777; font-weight: 500; }
    .code { background: #f0f0f0; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 13px; margin: 10px 0; overflow-x: auto; }
  </style>
</head>
<body>
  <h2>tpl 템플릿 엔진 테스트</h2>

  <!-- 1. 기본 사용 -->
  <section>
    <h3>1. 기본 사용 (ID로 템플릿 로드)</h3>
    <div class="code">tpl('#userTpl').render(data)</div>
    <div id="result1" class="test-result"></div>
  </section>

  <!-- 2. 헬퍼 함수 -->
  <section>
    <h3>2. 헬퍼 함수 사용</h3>
    <div class="code">{{ d._h.date(d.timestamp) }}, {{ d._h.number(d.price) }}</div>
    <div id="result2" class="test-result"></div>
  </section>

  <!-- 3. 커스텀 헬퍼 -->
  <section>
    <h3>3. 커스텀 헬퍼 등록</h3>
    <div class="code">tpl.helper('upper', function(str){ return str.toUpperCase(); })</div>
    <div id="result3" class="test-result"></div>
  </section>

  <!-- 4. renderTo -->
  <section>
    <h3>4. renderTo - DOM에 직접 렌더링</h3>
    <div class="code">tpl('#cardTpl').renderTo('#result4', data)</div>
    <div id="result4" class="test-result"></div>
  </section>

  <!-- 5. 비동기 렌더링 -->
  <section>
    <h3>5. renderAsync - Promise 기반</h3>
    <div class="code">tpl(template).renderAsync(data).then(html => ...)</div>
    <div id="result5" class="test-result"></div>
  </section>

  <!-- 6. 캐시 관리 -->
  <section>
    <h3>6. 캐시 관리</h3>
    <div class="code">tpl.list(), tpl.get('id'), tpl.clear('id')</div>
    <div id="result6" class="test-result"></div>
  </section>

  <!-- 템플릿 정의 -->
  <script type="text/html" id="userTpl">
    <ul>
    {{# for(var i = 0; i < d.list.length; i++){ }}
      <li><strong>{{ d.list[i].name }}</strong> - {{ d.list[i].age }}세</li>
    {{# } }}
    </ul>
    <p>총 {{ d.list.length }}명</p>
  </script>

  <script type="text/html" id="helperTpl">
    <p>날짜: {{ d._h.date(d.timestamp, 'yyyy-MM-dd HH:mm') }}</p>
    <p>금액: {{ d._h.number(d.price) }}원</p>
    <p>설명: {{ d._h.truncate(d.desc, 20) }}</p>
    <p>상태: {{ d._h.default(d.status, '미정') }}</p>
  </script>

  <script type="text/html" id="customTpl">
    <p>원본: {{ d.text }}</p>
    <p>대문자: {{ d._h.upper(d.text) }}</p>
    <p>소문자: {{ d._h.lower(d.text) }}</p>
  </script>

  <script type="text/html" id="cardTpl">
    <div style="padding:15px; border:1px solid #ddd; border-radius:8px;">
      <h4 style="margin:0 0 10px;">{{ d.title }}</h4>
      <p style="color:#666; margin:0;">{{ d.content }}</p>
    </div>
  </script>

  <script src="../catui.js"></script>
  <script>
    Catui.use(['$c', 'tpl'], function(){
      
      // 1. 기본 사용 - ID로 템플릿 로드
      var data1 = {
        list: [
          { name: '홍길동', age: 25 },
          { name: '김철수', age: 30 },
          { name: '이영희', age: 28 }
        ]
      };
      var html1 = tpl('#userTpl').render(data1);
      $c('#result1').html('<span class="test-pass">✓ ID 템플릿 로드 성공!</span>' + html1);

      // 2. 헬퍼 함수 사용
      var data2 = {
        timestamp: Date.now(),
        price: 1234567890,
        desc: '이것은 매우 긴 설명 문자열입니다. 잘려서 표시됩니다.',
        status: null
      };
      var html2 = tpl('#helperTpl').render(data2);
      $c('#result2').html('<span class="test-pass">✓ 내장 헬퍼 동작!</span>' + html2);

      // 3. 커스텀 헬퍼 등록
      tpl.helper('upper', function(str){ return str ? str.toUpperCase() : ''; });
      tpl.helper('lower', function(str){ return str ? str.toLowerCase() : ''; });
      
      var data3 = { text: 'Hello World' };
      var html3 = tpl('#customTpl').render(data3);
      $c('#result3').html('<span class="test-pass">✓ 커스텀 헬퍼 등록!</span>' + html3);

      // 4. renderTo - DOM에 직접 렌더링
      var data4 = {
        title: '공지사항',
        content: 'renderTo()로 직접 DOM에 렌더링되었습니다.'
      };
      tpl('#cardTpl').renderTo('#result4', data4, function(html, elem){
        console.log('renderTo 완료:', elem);
      });

      // 5. 비동기 렌더링
      var asyncTpl = '<p>비동기 결과: {{ d.message }}</p>';
      tpl(asyncTpl).renderAsync({ message: 'Promise 기반 렌더링 성공!' })
        .then(function(html){
          $c('#result5').html('<span class="test-pass">✓ renderAsync 성공!</span>' + html);
        })
        .catch(function(err){
          $c('#result5').html('에러: ' + err.message);
        });

      // 6. 캐시 관리
      var cached = tpl.list();
      var cacheInfo = '<p>캐시된 템플릿: ' + cached.join(', ') + '</p>';
      cacheInfo += '<p>tpl.get("userTpl"): ' + (tpl.get('userTpl') ? '존재' : '없음') + '</p>';
      $c('#result6').html('<span class="test-pass">✓ 캐시 관리!</span>' + cacheInfo);

    });
  </script>
</body>
</html>
