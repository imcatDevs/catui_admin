<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tree 테스트 - Catui</title>
  <link rel="stylesheet" href="../catui.css">
  <style>
    .test-section { padding: 20px; margin-bottom: 20px; background: #fff; border-radius: 8px; }
    .test-section h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .test-section h4 { margin: 15px 0 10px; color: #666; font-size: 14px; }
    .demo-box { display: flex; gap: 30px; flex-wrap: wrap; }
    .tree-wrap { min-width: 280px; border: 1px solid #eee; border-radius: 4px; padding: 15px; }
    .tree-wrap-title { font-weight: bold; margin-bottom: 10px; color: #333; font-size: 13px; }
    
    /* 스킨: 심플 (연결선 없음) */
    .cui-tree-simple .cui-tree-line { display: none; }
    .cui-tree-simple .cui-tree-set { padding-left: 20px; }
    
    /* 스킨: 폴더 */
    .cui-tree-folder .cui-tree-icon-click .cui-icon { color: #ffb800; }
    .cui-tree-folder .cui-tree-icon-leaf .cui-icon { color: #999; }
    
    /* 스킨: 다크 */
    .tree-wrap-dark { background: #2d2d2d; border-color: #444; }
    .tree-wrap-dark .cui-tree { color: #eee; }
    .tree-wrap-dark .cui-tree-txt:hover { color: #16baaa; }
    .tree-wrap-dark .cui-tree-active { color: #16baaa !important; }
    
    /* 스킨: 컴팩트 */
    .cui-tree-compact .cui-tree-entry { padding: 2px 0; }
    .cui-tree-compact .cui-tree-txt { font-size: 12px; }
    .cui-tree-compact .cui-icon { font-size: 16px; }
  </style>
</head>
<body style="padding: 20px; background: #f5f5f5;">
  <h2>Tree 트리 테스트</h2>

  <!-- 1. 기본 트리 스타일 비교 -->
  <div class="test-section">
    <h3>1. 기본 트리 스타일</h3>
    <div class="demo-box">
      <div class="tree-wrap">
        <div class="tree-wrap-title">연결선 있음 (기본)</div>
        <div id="tree1"></div>
      </div>
      <div class="tree-wrap">
        <div class="tree-wrap-title">연결선 없음</div>
        <div id="tree1b"></div>
      </div>
      <div class="tree-wrap">
        <div class="tree-wrap-title">아코디언 모드</div>
        <div id="tree1c"></div>
      </div>
    </div>
  </div>

  <!-- 2. 체크박스 트리 -->
  <div class="test-section">
    <h3>2. 체크박스 트리</h3>
    <div class="demo-box">
      <div class="tree-wrap">
        <div class="tree-wrap-title">기본 체크박스</div>
        <div id="tree2"></div>
        <div style="margin-top:10px;">
          <button class="cui-btn cui-btn-xs cui-btn-primary" onclick="getChecked()">선택 확인</button>
          <button class="cui-btn cui-btn-xs" onclick="setChecked()">일부 선택</button>
        </div>
      </div>
      <div class="tree-wrap">
        <div class="tree-wrap-title">비활성화 항목 포함</div>
        <div id="tree2b"></div>
      </div>
    </div>
  </div>

  <!-- 3. 편집 트리 -->
  <div class="test-section">
    <h3>3. 편집 가능한 트리</h3>
    <div class="demo-box">
      <div class="tree-wrap">
        <div class="tree-wrap-title">전체 편집 (추가/수정/삭제)</div>
        <div id="tree3"></div>
      </div>
      <div class="tree-wrap">
        <div class="tree-wrap-title">추가만</div>
        <div id="tree3b"></div>
      </div>
    </div>
  </div>

  <!-- 4. 스킨 모드 -->
  <div class="test-section">
    <h3>4. 스킨 모드</h3>
    <div class="demo-box">
      <div class="tree-wrap">
        <div class="tree-wrap-title">폴더 스타일</div>
        <div id="tree4" class="cui-tree-folder"></div>
      </div>
      <div class="tree-wrap tree-wrap-dark">
        <div class="tree-wrap-title" style="color:#eee;">다크 모드</div>
        <div id="tree4b"></div>
      </div>
      <div class="tree-wrap">
        <div class="tree-wrap-title">컴팩트 스타일</div>
        <div id="tree4c" class="cui-tree-compact"></div>
      </div>
    </div>
  </div>

  <!-- 5. 링크 트리 -->
  <div class="test-section">
    <h3>5. 링크 트리</h3>
    <div class="demo-box">
      <div class="tree-wrap">
        <div class="tree-wrap-title">외부 링크 연결</div>
        <div id="tree5"></div>
      </div>
    </div>
  </div>

  <!-- 6. 이벤트 로그 -->
  <div class="test-section">
    <h3>6. 이벤트 테스트</h3>
    <div class="demo-box">
      <div class="tree-wrap">
        <div class="tree-wrap-title">이벤트 리스너 (tree.on)</div>
        <div id="tree6"></div>
      </div>
      <div style="flex:1;min-width:300px;">
        <div class="tree-wrap-title">이벤트 로그</div>
        <div id="eventLog" style="background:#333;color:#0f0;padding:10px;border-radius:4px;font-family:monospace;font-size:12px;height:200px;overflow-y:auto;">// 이벤트 로그</div>
      </div>
    </div>
  </div>

  <script src="../catui.js"></script>
  <script>
    // 샘플 데이터: 파일 트리
    var fileTreeData = [
      {
        id: 1,
        title: '문서',
        spread: true,
        children: [
          { id: 11, title: '프로젝트 계획서.docx' },
          { id: 12, title: '요구사항 정의서.xlsx' },
          {
            id: 13,
            title: '설계 문서',
            children: [
              { id: 131, title: 'DB 설계.pdf' },
              { id: 132, title: 'API 설계.md' }
            ]
          }
        ]
      },
      {
        id: 2,
        title: '이미지',
        children: [
          { id: 21, title: 'logo.png' },
          { id: 22, title: 'banner.jpg' }
        ]
      },
      {
        id: 3,
        title: '소스코드',
        spread: true,
        children: [
          { id: 31, title: 'index.html' },
          { id: 32, title: 'style.css' },
          { id: 33, title: 'script.js' }
        ]
      }
    ];

    // 샘플 데이터: 메뉴 트리
    var menuTreeData = [
      {
        id: 'm1',
        title: '대시보드',
        href: '/dashboard'
      },
      {
        id: 'm2',
        title: '사용자 관리',
        spread: true,
        children: [
          { id: 'm21', title: '사용자 목록', href: '/users' },
          { id: 'm22', title: '권한 설정', href: '/permissions' }
        ]
      },
      {
        id: 'm3',
        title: '시스템 설정',
        children: [
          { id: 'm31', title: '기본 설정', href: '/settings' },
          { id: 'm32', title: '로그', href: '/logs' }
        ]
      }
    ];

    // 샘플 데이터: 비활성화 포함
    var disabledTreeData = [
      {
        id: 'd1',
        title: '전체 선택 가능',
        spread: true,
        children: [
          { id: 'd11', title: '선택 가능 항목 1' },
          { id: 'd12', title: '비활성화 항목', disabled: true },
          { id: 'd13', title: '선택 가능 항목 2' }
        ]
      },
      {
        id: 'd2',
        title: '기본 체크됨',
        checked: true,
        children: [
          { id: 'd21', title: '하위 항목 1', checked: true },
          { id: 'd22', title: '하위 항목 2' }
        ]
      }
    ];

    // 로그 함수
    function log(msg) {
      var logEl = document.getElementById('eventLog');
      var time = new Date().toLocaleTimeString();
      logEl.innerHTML = '[' + time + '] ' + msg + '\n' + logEl.innerHTML;
    }

    var tree2Inst;

    Catui.use(['$c', 'tree', 'popup'], function(){
      var tree = Catui.tree;
      var popup = Catui.popup;

      // =====================
      // 1. 기본 트리 스타일
      // =====================
      
      // 연결선 있음 (기본)
      tree.render({
        elem: '#tree1',
        id: 'basic1',
        data: fileTreeData,
        showLine: true,
        click: function(obj){
          popup.msg('선택: ' + obj.data.title);
        }
      });

      // 연결선 없음
      tree.render({
        elem: '#tree1b',
        id: 'basic2',
        data: fileTreeData,
        showLine: false
      });

      // 아코디언 모드
      tree.render({
        elem: '#tree1c',
        id: 'basic3',
        data: fileTreeData,
        showLine: true,
        accordion: true
      });

      // =====================
      // 2. 체크박스 트리
      // =====================
      
      // 기본 체크박스
      tree2Inst = tree.render({
        elem: '#tree2',
        id: 'check1',
        data: fileTreeData,
        showCheckbox: true,
        showLine: true
      });

      // 비활성화 항목 포함
      tree.render({
        elem: '#tree2b',
        id: 'check2',
        data: disabledTreeData,
        showCheckbox: true,
        showLine: true
      });

      // =====================
      // 3. 편집 트리
      // =====================
      
      // 전체 편집
      tree.render({
        elem: '#tree3',
        id: 'edit1',
        data: fileTreeData,
        showLine: true,
        edit: ['add', 'update', 'del'],
        operate: function(obj){
          if(obj.type === 'add'){
            popup.msg('추가: ' + obj.data.title);
          } else if(obj.type === 'update'){
            popup.prompt({
              title: '이름 변경',
              value: obj.data.title
            }, function(value){
              popup.msg('변경: ' + value);
            });
          } else if(obj.type === 'del'){
            popup.confirm('삭제하시겠습니까?', function(){
              popup.msg('삭제됨');
            });
          }
        }
      });

      // 추가만
      tree.render({
        elem: '#tree3b',
        id: 'edit2',
        data: fileTreeData,
        showLine: true,
        edit: ['add'],
        operate: function(obj){
          popup.msg('추가: ' + obj.data.title);
        }
      });

      // =====================
      // 4. 스킨 모드
      // =====================
      
      // 폴더 스타일
      tree.render({
        elem: '#tree4',
        id: 'skin1',
        data: fileTreeData,
        showLine: true
      });

      // 다크 모드
      tree.render({
        elem: '#tree4b',
        id: 'skin2',
        data: fileTreeData,
        showLine: true
      });

      // 컴팩트 스타일
      tree.render({
        elem: '#tree4c',
        id: 'skin3',
        data: fileTreeData,
        showLine: true
      });

      // =====================
      // 5. 링크 트리
      // =====================
      tree.render({
        elem: '#tree5',
        id: 'link1',
        data: menuTreeData,
        showLine: true,
        isJump: true
      });

      // =====================
      // 6. 이벤트 테스트
      // =====================
      tree.render({
        elem: '#tree6',
        id: 'event1',
        data: fileTreeData,
        showLine: true,
        showCheckbox: true,
        edit: ['add', 'del']
      });

      // 이벤트 리스너
      tree.on('click(event1)', function(obj){
        log('click → ' + obj.data.title);
      });

      tree.on('checkbox(event1)', function(obj){
        log('checkbox → ' + obj.data.title + ' (' + (obj.checked ? '체크' : '해제') + ')');
      });

      tree.on('operate(event1)', function(obj){
        log('operate → ' + obj.type + ' : ' + obj.data.title);
      });

    });

    // 외부 API 함수
    function getChecked(){
      if(tree2Inst){
        var checked = tree2Inst.getChecked();
        console.log('선택된 항목:', checked);
        var names = checked.map(function(item){ return item.title; }).join(', ');
        Catui.popup.msg('선택: ' + (names || '없음'));
      }
    }

    function setChecked(){
      // tree API로 선택
      Catui.tree.setChecked('check1', [11, 31]);
      Catui.popup.msg('11, 31 선택됨');
    }
  </script>
</body>
</html>
