<div class="cui-fluid">
  <!-- 페이지 헤더 -->
  <div class="cui-page-header cui-mb-15">
    <div class="cui-page-title-wrap">
      <h2 class="cui-page-title">복잡한 JSON 데이터</h2>
      <button type="button" class="cui-page-refresh" onclick="router.refresh()"><i class="cui-icon">refresh</i></button>
    </div>
    <div class="cui-breadcrumb">
      <a href="javascript:;">홈</a>
      <a href="javascript:;">테이블예제</a>
      <span>JSON 데이터</span>
    </div>
  </div>

  <!-- 중첩 객체 데이터 -->
  <div class="cui-card cui-mb-15">
    <div class="cui-card-header cui-flex cui-flex-between cui-flex-middle">
      <span>중첩 객체 데이터</span>
      <code class="cui-text-secondary">d.user.name | d.address.city</code>
    </div>
    <div class="cui-card-body">
      <p class="cui-text-secondary cui-mb-10">중첩된 객체 데이터를 <code>templet</code>으로 접근합니다.</p>
      <table id="tableNested"></table>
    </div>
  </div>

  <!-- 배열 데이터 처리 -->
  <div class="cui-card cui-mb-15">
    <div class="cui-card-header cui-flex cui-flex-between cui-flex-middle">
      <span>배열 데이터 처리</span>
      <code class="cui-text-secondary">d.tags.join() | d.scores.length</code>
    </div>
    <div class="cui-card-body">
      <p class="cui-text-secondary cui-mb-10">배열 데이터를 가공하여 표시합니다.</p>
      <table id="tableArray"></table>
    </div>
  </div>

  <!-- 조건부 렌더링 -->
  <div class="cui-card cui-mb-15">
    <div class="cui-card-header cui-flex cui-flex-between cui-flex-middle">
      <span>조건부 렌더링</span>
      <code class="cui-text-secondary">if/else | switch</code>
    </div>
    <div class="cui-card-body">
      <p class="cui-text-secondary cui-mb-10">데이터 값에 따라 다른 UI를 렌더링합니다.</p>
      <table id="tableCondition"></table>
    </div>
  </div>

  <!-- 계산된 필드 -->
  <div class="cui-card cui-mb-15">
    <div class="cui-card-header cui-flex cui-flex-between cui-flex-middle">
      <span>계산된 필드</span>
      <code class="cui-text-secondary">d.price * d.quantity</code>
    </div>
    <div class="cui-card-body">
      <p class="cui-text-secondary cui-mb-10">여러 필드를 조합하여 계산된 값을 표시합니다.</p>
      <table id="tableCalculated"></table>
    </div>
  </div>

  <!-- 날짜/시간 포맷팅 -->
  <div class="cui-card cui-mb-15">
    <div class="cui-card-header cui-flex cui-flex-between cui-flex-middle">
      <span>날짜/시간 포맷팅</span>
      <code class="cui-text-secondary">timestamp → 포맷된 날짜</code>
    </div>
    <div class="cui-card-body">
      <p class="cui-text-secondary cui-mb-10">타임스탬프나 ISO 문자열을 포맷팅합니다.</p>
      <table id="tableDate"></table>
    </div>
  </div>

  <!-- 복합 JSON 구조 -->
  <div class="cui-card">
    <div class="cui-card-header cui-flex cui-flex-between cui-flex-middle">
      <span>복합 JSON 구조</span>
      <code class="cui-text-secondary">실제 API 응답 형태</code>
    </div>
    <div class="cui-card-body">
      <p class="cui-text-secondary cui-mb-10">실제 API에서 받을 수 있는 복합적인 JSON 구조를 처리합니다.</p>
      <table id="tableComplex"></table>
    </div>
  </div>
</div>

<script>
Catui.use(['table'], function(){
  
  // 1. 중첩 객체 데이터
  var nestedData = [
    { 
      id: 1, 
      user: { name: '홍길동', email: 'hong@test.com', role: 'admin' },
      address: { city: '서울', district: '강남구', zipcode: '06000' },
      company: { name: 'ABC Corp', department: '개발팀' }
    },
    { 
      id: 2, 
      user: { name: '김철수', email: 'kim@test.com', role: 'user' },
      address: { city: '부산', district: '해운대구', zipcode: '48000' },
      company: { name: 'XYZ Inc', department: '디자인팀' }
    },
    { 
      id: 3, 
      user: { name: '이영희', email: 'lee@test.com', role: 'editor' },
      address: { city: '대전', district: '유성구', zipcode: '34000' },
      company: { name: 'ABC Corp', department: '마케팅팀' }
    }
  ];

  table.render({
    elem: '#tableNested',
    data: nestedData,
    cols: [[
      { field: 'id', title: 'ID', width: 60 },
      { title: '사용자', width: 150, templet: function(d){
        return '<strong>' + d.user.name + '</strong><br><small class="cui-text-secondary">' + d.user.email + '</small>';
      }},
      { title: '역할', width: 80, templet: function(d){
        var roles = { admin: '관리자', user: '사용자', editor: '편집자' };
        var colors = { admin: 'cui-bg-danger', user: 'cui-bg-success', editor: 'cui-bg-primary' };
        return '<span class="cui-badge ' + colors[d.user.role] + '">' + roles[d.user.role] + '</span>';
      }},
      { title: '주소', templet: function(d){
        return d.address.city + ' ' + d.address.district + ' (' + d.address.zipcode + ')';
      }},
      { title: '회사/부서', width: 150, templet: function(d){
        return d.company.name + ' / ' + d.company.department;
      }}
    ]]
  });

  // 2. 배열 데이터 처리
  var arrayData = [
    { 
      id: 1, 
      name: '프로젝트 A',
      tags: ['웹', 'React', 'TypeScript'],
      members: [
        { name: '홍길동', role: 'PM' },
        { name: '김철수', role: 'Dev' },
        { name: '이영희', role: 'Design' }
      ],
      scores: [85, 90, 78, 92]
    },
    { 
      id: 2, 
      name: '프로젝트 B',
      tags: ['모바일', 'Flutter'],
      members: [
        { name: '박지민', role: 'PM' },
        { name: '최수진', role: 'Dev' }
      ],
      scores: [75, 88, 82]
    },
    { 
      id: 3, 
      name: '프로젝트 C',
      tags: ['백엔드', 'Node.js', 'MongoDB', 'Docker'],
      members: [
        { name: '정민수', role: 'PM' },
        { name: '강하나', role: 'Dev' },
        { name: '윤서영', role: 'Dev' },
        { name: '오준호', role: 'QA' }
      ],
      scores: [95, 88, 91, 87, 93]
    }
  ];

  table.render({
    elem: '#tableArray',
    data: arrayData,
    cols: [[
      { field: 'id', title: 'ID', width: 60 },
      { field: 'name', title: '프로젝트', width: 120 },
      { title: '태그', templet: function(d){
        return d.tags.map(function(tag){
          return '<span class="cui-badge cui-bg-primary" style="margin-right:4px;">' + tag + '</span>';
        }).join('');
      }},
      { title: '팀원', width: 200, templet: function(d){
        return d.members.map(function(m){
          return m.name + '(' + m.role + ')';
        }).join(', ');
      }},
      { title: '점수', width: 180, templet: function(d){
        var avg = (d.scores.reduce(function(a,b){ return a+b; }, 0) / d.scores.length).toFixed(1);
        var max = Math.max.apply(null, d.scores);
        var min = Math.min.apply(null, d.scores);
        return '평균: <strong>' + avg + '</strong> (최고: ' + max + ', 최저: ' + min + ')';
      }}
    ]]
  });

  // 3. 조건부 렌더링
  var conditionData = [
    { id: 1, name: '상품 A', status: 'active', stock: 150, priority: 'high', discount: 20 },
    { id: 2, name: '상품 B', status: 'inactive', stock: 0, priority: 'low', discount: 0 },
    { id: 3, name: '상품 C', status: 'pending', stock: 25, priority: 'medium', discount: 10 },
    { id: 4, name: '상품 D', status: 'active', stock: 5, priority: 'high', discount: 30 },
    { id: 5, name: '상품 E', status: 'active', stock: 80, priority: 'low', discount: 0 }
  ];

  table.render({
    elem: '#tableCondition',
    data: conditionData,
    cols: [[
      { field: 'id', title: 'ID', width: 60 },
      { field: 'name', title: '상품명', width: 100 },
      { title: '상태', width: 80, templet: function(d){
        var statusMap = {
          active: { text: '판매중', class: 'cui-bg-success' },
          inactive: { text: '중단', class: 'cui-bg-gray' },
          pending: { text: '대기', class: 'cui-bg-warm' }
        };
        var s = statusMap[d.status];
        return '<span class="cui-badge ' + s.class + '">' + s.text + '</span>';
      }},
      { title: '재고', width: 100, templet: function(d){
        if(d.stock === 0){
          return '<span class="cui-text-danger"><i class="cui-icon" style="font-size:14px;">error</i> 품절</span>';
        } else if(d.stock <= 10){
          return '<span class="cui-text-warm"><i class="cui-icon" style="font-size:14px;">warning</i> ' + d.stock + '개 (부족)</span>';
        } else {
          return '<span class="cui-text-success">' + d.stock + '개</span>';
        }
      }},
      { title: '우선순위', width: 100, templet: function(d){
        var icons = { high: '⬆️ 높음', medium: '➡️ 보통', low: '⬇️ 낮음' };
        return icons[d.priority];
      }},
      { title: '할인', width: 100, templet: function(d){
        if(d.discount > 0){
          return '<span class="cui-badge cui-bg-danger">' + d.discount + '% OFF</span>';
        }
        return '<span class="cui-text-secondary">-</span>';
      }}
    ]]
  });

  // 4. 계산된 필드
  var calculatedData = [
    { id: 1, product: '노트북', price: 1500000, quantity: 3, taxRate: 10 },
    { id: 2, product: '모니터', price: 350000, quantity: 5, taxRate: 10 },
    { id: 3, product: '키보드', price: 89000, quantity: 10, taxRate: 10 },
    { id: 4, product: '마우스', price: 45000, quantity: 20, taxRate: 10 }
  ];

  table.render({
    elem: '#tableCalculated',
    data: calculatedData,
    totalRow: true,
    cols: [[
      { field: 'id', title: 'ID', width: 60 },
      { field: 'product', title: '상품', width: 100 },
      { field: 'price', title: '단가', width: 120, align: 'right', templet: function(d){
        return d.price.toLocaleString() + '원';
      }},
      { field: 'quantity', title: '수량', width: 80, align: 'right', totalRow: true },
      { title: '소계', width: 130, align: 'right', templet: function(d){
        return (d.price * d.quantity).toLocaleString() + '원';
      }, totalRow: function(data){
        var sum = data.reduce(function(a, d){ return a + d.price * d.quantity; }, 0);
        return sum.toLocaleString() + '원';
      }},
      { title: '세금', width: 100, align: 'right', templet: function(d){
        var tax = d.price * d.quantity * d.taxRate / 100;
        return tax.toLocaleString() + '원';
      }, totalRow: function(data){
        var sum = data.reduce(function(a, d){ return a + d.price * d.quantity * d.taxRate / 100; }, 0);
        return sum.toLocaleString() + '원';
      }},
      { title: '합계', width: 140, align: 'right', templet: function(d){
        var subtotal = d.price * d.quantity;
        var tax = subtotal * d.taxRate / 100;
        return '<strong>' + (subtotal + tax).toLocaleString() + '원</strong>';
      }, totalRow: function(data){
        var sum = data.reduce(function(a, d){ 
          var subtotal = d.price * d.quantity;
          return a + subtotal + subtotal * d.taxRate / 100;
        }, 0);
        return '<strong>' + sum.toLocaleString() + '원</strong>';
      }}
    ]]
  });

  // 5. 날짜/시간 포맷팅
  var dateData = [
    { id: 1, event: '가입', timestamp: 1702454400000, isoDate: '2024-12-13T10:00:00Z', duration: 3600 },
    { id: 2, event: '로그인', timestamp: 1702540800000, isoDate: '2024-12-14T10:00:00Z', duration: 7200 },
    { id: 3, event: '구매', timestamp: 1702627200000, isoDate: '2024-12-15T10:00:00Z', duration: 1800 },
    { id: 4, event: '리뷰', timestamp: 1702713600000, isoDate: '2024-12-16T10:00:00Z', duration: 300 }
  ];

  var formatDate = function(ts){
    var d = new Date(ts);
    return d.getFullYear() + '-' + 
      String(d.getMonth()+1).padStart(2,'0') + '-' + 
      String(d.getDate()).padStart(2,'0');
  };

  var formatDateTime = function(iso){
    var d = new Date(iso);
    return d.getFullYear() + '-' + 
      String(d.getMonth()+1).padStart(2,'0') + '-' + 
      String(d.getDate()).padStart(2,'0') + ' ' +
      String(d.getHours()).padStart(2,'0') + ':' +
      String(d.getMinutes()).padStart(2,'0');
  };

  var formatDuration = function(seconds){
    if(seconds >= 3600){
      return Math.floor(seconds/3600) + '시간 ' + Math.floor((seconds%3600)/60) + '분';
    } else if(seconds >= 60){
      return Math.floor(seconds/60) + '분';
    }
    return seconds + '초';
  };

  var timeAgo = function(ts){
    var diff = Date.now() - ts;
    var days = Math.floor(diff / (1000*60*60*24));
    if(days > 0) return days + '일 전';
    var hours = Math.floor(diff / (1000*60*60));
    if(hours > 0) return hours + '시간 전';
    return '방금 전';
  };

  table.render({
    elem: '#tableDate',
    data: dateData,
    cols: [[
      { field: 'id', title: 'ID', width: 60 },
      { field: 'event', title: '이벤트', width: 80 },
      { title: '날짜 (timestamp)', width: 130, templet: function(d){
        return formatDate(d.timestamp);
      }},
      { title: '일시 (ISO)', width: 150, templet: function(d){
        return formatDateTime(d.isoDate);
      }},
      { title: '경과 시간', width: 100, templet: function(d){
        return timeAgo(d.timestamp);
      }},
      { title: '소요 시간', width: 120, templet: function(d){
        return formatDuration(d.duration);
      }}
    ]]
  });

  // 6. 복합 JSON 구조 (실제 API 응답 형태)
  var complexData = [
    {
      id: 'ORD-001',
      customer: {
        id: 'C001',
        name: '홍길동',
        vip: true,
        contacts: { email: 'hong@test.com', phone: '010-1234-5678' }
      },
      items: [
        { name: '노트북', qty: 1, price: 1500000 },
        { name: '마우스', qty: 2, price: 45000 }
      ],
      shipping: { method: 'express', fee: 3000, address: '서울시 강남구' },
      payment: { method: 'card', status: 'completed', paidAt: '2024-03-15T14:30:00Z' },
      meta: { createdAt: '2024-03-15T14:00:00Z', updatedAt: '2024-03-15T14:30:00Z' }
    },
    {
      id: 'ORD-002',
      customer: {
        id: 'C002',
        name: '김철수',
        vip: false,
        contacts: { email: 'kim@test.com', phone: '010-2345-6789' }
      },
      items: [
        { name: '키보드', qty: 1, price: 89000 }
      ],
      shipping: { method: 'standard', fee: 0, address: '부산시 해운대구' },
      payment: { method: 'bank', status: 'pending', paidAt: null },
      meta: { createdAt: '2024-03-16T09:00:00Z', updatedAt: '2024-03-16T09:00:00Z' }
    },
    {
      id: 'ORD-003',
      customer: {
        id: 'C003',
        name: '이영희',
        vip: true,
        contacts: { email: 'lee@test.com', phone: '010-3456-7890' }
      },
      items: [
        { name: '모니터', qty: 2, price: 350000 },
        { name: '헤드셋', qty: 1, price: 120000 },
        { name: 'USB 허브', qty: 3, price: 25000 }
      ],
      shipping: { method: 'express', fee: 3000, address: '대전시 유성구' },
      payment: { method: 'card', status: 'completed', paidAt: '2024-03-16T11:00:00Z' },
      meta: { createdAt: '2024-03-16T10:30:00Z', updatedAt: '2024-03-16T11:00:00Z' }
    }
  ];

  table.render({
    elem: '#tableComplex',
    data: complexData,
    cols: [[
      { field: 'id', title: '주문번호', width: 100 },
      { title: '고객', width: 140, templet: function(d){
        var vipBadge = d.customer.vip ? ' <span class="cui-badge cui-bg-warm">VIP</span>' : '';
        return '<strong>' + d.customer.name + '</strong>' + vipBadge + 
          '<br><small class="cui-text-secondary">' + d.customer.contacts.email + '</small>';
      }},
      { title: '주문 상품', templet: function(d){
        return d.items.map(function(item){
          return item.name + ' x' + item.qty;
        }).join(', ') + ' <small class="cui-text-secondary">(' + d.items.length + '종)</small>';
      }},
      { title: '총 금액', width: 130, align: 'right', templet: function(d){
        var itemTotal = d.items.reduce(function(sum, item){
          return sum + item.price * item.qty;
        }, 0);
        var total = itemTotal + d.shipping.fee;
        return '<strong>' + total.toLocaleString() + '원</strong>' +
          (d.shipping.fee > 0 ? '<br><small class="cui-text-secondary">배송비 ' + d.shipping.fee.toLocaleString() + '원 포함</small>' : '');
      }},
      { title: '배송', width: 90, templet: function(d){
        var methods = { express: '빠른배송', standard: '일반배송' };
        var colors = { express: 'cui-text-primary', standard: 'cui-text-secondary' };
        return '<span class="' + colors[d.shipping.method] + '">' + methods[d.shipping.method] + '</span>';
      }},
      { title: '결제', width: 100, templet: function(d){
        var statusMap = {
          completed: { text: '완료', class: 'cui-bg-success' },
          pending: { text: '대기', class: 'cui-bg-warm' },
          failed: { text: '실패', class: 'cui-bg-danger' }
        };
        var s = statusMap[d.payment.status];
        var method = d.payment.method === 'card' ? '카드' : '계좌이체';
        return method + '<br><span class="cui-badge ' + s.class + '">' + s.text + '</span>';
      }}
    ]]
  });
});
</script>
</div>
