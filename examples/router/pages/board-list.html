<div class="cui-fluid">
  <!-- 페이지 헤더 -->
  <div class="cui-page-header cui-mb-15">
    <div class="cui-page-title-wrap">
      <h2 class="cui-page-title">게시판 목록</h2>
      <button type="button" class="cui-page-refresh" onclick="router.refresh()"><i class="cui-icon">refresh</i></button>
    </div>
    <div class="cui-breadcrumb">
      <a href="javascript:;">홈</a>
      <a href="javascript:;">게시판</a>
      <span>목록</span>
    </div>
  </div>

  <!-- 검색 영역 -->
  <div class="cui-card cui-mb-15">
    <div class="cui-card-body cui-p-10">
      <form class="cui-form" cui-filter="boardSearch">
        <div class="cui-flex cui-flex-middle cui-cols-gap-10">
          <select name="searchType" class="cui-select cui-select-sm" style="width: 100px;">
            <option value="title">제목</option>
            <option value="content">내용</option>
            <option value="writer">작성자</option>
          </select>
          <input type="text" name="keyword" class="cui-input cui-input-sm" placeholder="검색어를 입력하세요" style="width: 200px;">
          <button type="submit" class="cui-btn cui-btn-sm cui-btn-primary"><i class="cui-icon">search</i> 검색</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 게시글 목록 -->
  <div class="cui-card">
    <div class="cui-card-header cui-flex cui-flex-between cui-flex-middle">
      <span>게시글 목록</span>
      <button id="btnWrite" class="cui-btn cui-btn-sm cui-btn-primary"><i class="cui-icon">edit</i> 글쓰기</button>
    </div>
    <div class="cui-card-body cui-p-0">
      <table id="boardTable"></table>
    </div>
  </div>
</div>

<script>
Catui.use(['table', 'form', 'popup', 'page'], function(){
  // 샘플 데이터
  var boardData = [];
  for(var i = 1; i <= 53; i++){
    boardData.push({
      id: i,
      title: '게시글 제목 ' + i + ' - 샘플 데이터입니다',
      writer: ['홍길동', '김철수', '이영희', '박지민', '최수진'][i % 5],
      date: '2024-12-' + String(Math.floor(Math.random() * 28) + 1).padStart(2, '0'),
      views: Math.floor(Math.random() * 500),
      status: i % 3 === 0 ? '공지' : '일반'
    });
  }

  // 테이블 렌더링
  table.render({
    elem: '#boardTable',
    id: 'boardTable',
    data: boardData,
    page: true,
    limit: 10,
    limits: [10, 20, 50],
    cols: [[
      { field: 'id', title: '번호', width: 80, sort: true, align: 'center' },
      { field: 'status', title: '구분', width: 80, align: 'center', templet: function(d){
        return d.status === '공지' ? '<span class="cui-badge cui-badge-primary">공지</span>' : '<span class="cui-badge">일반</span>';
      }},
      { field: 'title', title: '제목', templet: function(d){
        return '<a href="javascript:;" class="cui-link" onclick="viewBoard(' + d.id + ')">' + d.title + '</a>';
      }},
      { field: 'writer', title: '작성자', width: 100, align: 'center' },
      { field: 'date', title: '작성일', width: 120, align: 'center', sort: true },
      { field: 'views', title: '조회수', width: 80, align: 'center', sort: true }
    ]]
  });

  // 검색
  form.on('submit(boardSearch)', function(data){
    var keyword = data.field.keyword;
    var searchType = data.field.searchType;
    
    if(!keyword){
      table.reload('boardTable', { data: boardData, page: { curr: 1 } });
      popup.msg('전체 목록을 표시합니다');
      return false;
    }

    var filtered = boardData.filter(function(item){
      if(searchType === 'title') return item.title.indexOf(keyword) > -1;
      if(searchType === 'writer') return item.writer.indexOf(keyword) > -1;
      return item.title.indexOf(keyword) > -1;
    });

    table.reload('boardTable', { data: filtered, page: { curr: 1 } });
    popup.msg(filtered.length + '건이 검색되었습니다');
    return false;
  });

  // 글쓰기
  document.getElementById('btnWrite').addEventListener('click', function(){
    router.go('/examples/router/pages/board-write.html');
  });

  // 상세보기 함수
  window.viewBoard = function(id){
    router.go('/examples/router/pages/board-view.html?id=' + id);
  };
});
</script>
</div>
