<div class="cui-fluid">
  <!-- 페이지 헤더 -->
  <div class="cui-page-header cui-mb-15">
    <div class="cui-page-title-wrap">
      <h2 class="cui-page-title">연락처</h2>
    </div>
    <div class="cui-breadcrumb">
      <a href="javascript:;">홈</a>
      <a href="javascript:;">페이지</a>
      <span>연락처</span>
    </div>
  </div>

  <!-- 검색/필터 -->
  <div class="cui-card cui-mb-15">
    <div class="cui-card-body">
      <div class="cui-flex cui-gap-10 cui-flex-wrap cui-flex-between">
        <div class="cui-flex cui-gap-10 cui-flex-middle">
          <div class="search-box">
            <i class="cui-icon">search</i>
            <input type="text" id="searchInput" placeholder="이름, 이메일, 부서 검색...">
          </div>
          <div class="filter-box">
            <i class="cui-icon">filter_list</i>
            <select id="deptFilter">
              <option value="">전체 부서</option>
              <option value="개발팀">개발팀</option>
              <option value="디자인팀">디자인팀</option>
              <option value="기획팀">기획팀</option>
              <option value="마케팅팀">마케팅팀</option>
            </select>
          </div>
        </div>
        <div class="cui-flex cui-gap-10">
          <button class="cui-btn cui-btn-icon" id="viewGrid" title="그리드"><i class="cui-icon">grid_view</i></button>
          <button class="cui-btn cui-btn-icon" id="viewList" title="리스트"><i class="cui-icon">view_list</i></button>
          <button class="cui-btn cui-btn-primary" id="btnAddContact"><i class="cui-icon">person_add</i> 연락처 추가</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 연락처 그리드 -->
  <div class="contact-grid" id="contactGrid"></div>
</div>

<style>
.search-box, .filter-box {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #fff;
  border: 1px solid var(--cui-border);
  border-radius: 6px;
  padding: 0 12px;
  height: 36px;
}
.search-box .cui-icon, .filter-box .cui-icon { color: var(--cui-text-secondary); font-size: 20px; }
.search-box input, .filter-box select {
  border: none;
  outline: none;
  background: transparent;
  font-size: 14px;
  height: 100%;
}
.search-box input { width: 200px; }
.filter-box select { width: 100px; cursor: pointer; }

.contact-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
.contact-card { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s; }
.contact-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.contact-avatar { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: #fff; font-weight: 600; }
.contact-name { font-size: 18px; font-weight: 600; margin-bottom: 5px; text-align: center; }
.contact-role { color: var(--cui-text-secondary); font-size: 13px; text-align: center; margin-bottom: 15px; }
.contact-info { border-top: 1px solid var(--cui-border); padding-top: 15px; }
.contact-info-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; font-size: 13px; }
.contact-info-item .cui-icon { color: var(--cui-text-secondary); font-size: 18px; }
.contact-actions { display: flex; gap: 8px; margin-top: 15px; justify-content: center; }
.contact-status { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-left: 5px; }
.contact-status.online { background: #52c41a; }
.contact-status.offline { background: #d9d9d9; }
.contact-status.busy { background: #ff4d4f; }

.contact-list { display: flex; flex-direction: column; gap: 10px; }
.contact-list .contact-card { display: flex; align-items: center; gap: 20px; padding: 15px 20px; }
.contact-list .contact-avatar { width: 50px; height: 50px; margin: 0; font-size: 20px; flex-shrink: 0; }
.contact-list .contact-main { flex: 1; display: flex; align-items: center; gap: 30px; }
.contact-list .contact-name { text-align: left; margin: 0; font-size: 16px; }
.contact-list .contact-role { text-align: left; margin: 0; }
.contact-list .contact-info { border: none; padding: 0; display: flex; gap: 30px; }
.contact-list .contact-info-item { padding: 0; }
.contact-list .contact-actions { margin: 0; }
</style>

<script>
Catui.use(['popup', 'dropdown'], function(){
  var bindEvent = window.router ? router.bindEvent.bind(router) : function(el, type, fn){
    document.querySelector(el).addEventListener(type, fn);
  };

  var contacts = [
    { id: 1, name: '김철수', dept: '개발팀', role: '시니어 개발자', email: 'kim@example.com', phone: '010-1234-5678', status: 'online', color: '#1677ff' },
    { id: 2, name: '이영희', dept: '디자인팀', role: 'UI/UX 디자이너', email: 'lee@example.com', phone: '010-2345-6789', status: 'online', color: '#52c41a' },
    { id: 3, name: '박민수', dept: '기획팀', role: '프로덕트 매니저', email: 'park@example.com', phone: '010-3456-7890', status: 'busy', color: '#faad14' },
    { id: 4, name: '최지연', dept: '마케팅팀', role: '마케팅 담당자', email: 'choi@example.com', phone: '010-4567-8901', status: 'offline', color: '#ff4d4f' },
    { id: 5, name: '정우진', dept: '개발팀', role: '백엔드 개발자', email: 'jung@example.com', phone: '010-5678-9012', status: 'online', color: '#722ed1' },
    { id: 6, name: '한소희', dept: '디자인팀', role: '그래픽 디자이너', email: 'han@example.com', phone: '010-6789-0123', status: 'offline', color: '#eb2f96' },
    { id: 7, name: '송민준', dept: '개발팀', role: '프론트엔드 개발자', email: 'song@example.com', phone: '010-7890-1234', status: 'online', color: '#13c2c2' },
    { id: 8, name: '윤서아', dept: '기획팀', role: '서비스 기획자', email: 'yoon@example.com', phone: '010-8901-2345', status: 'busy', color: '#fa8c16' }
  ];

  var viewMode = 'grid';
  var searchText = '';
  var deptFilter = '';

  function renderContacts(){
    var filtered = contacts.filter(function(c){
      var matchSearch = !searchText || 
        c.name.includes(searchText) || 
        c.email.includes(searchText) || 
        c.dept.includes(searchText);
      var matchDept = !deptFilter || c.dept === deptFilter;
      return matchSearch && matchDept;
    });

    var html = filtered.map(function(c){
      var initials = c.name.substring(0, 1);
      if(viewMode === 'grid'){
        return '<div class="contact-card" data-id="' + c.id + '">' +
          '<div class="contact-avatar" style="background:' + c.color + ';">' + initials + '</div>' +
          '<div class="contact-name">' + c.name + '<span class="contact-status ' + c.status + '"></span></div>' +
          '<div class="contact-role">' + c.role + ' · ' + c.dept + '</div>' +
          '<div class="contact-info">' +
            '<div class="contact-info-item"><i class="cui-icon">email</i>' + c.email + '</div>' +
            '<div class="contact-info-item"><i class="cui-icon">phone</i>' + c.phone + '</div>' +
          '</div>' +
          '<div class="contact-actions">' +
            '<button class="cui-btn cui-btn-sm cui-btn-primary btn-message"><i class="cui-icon">mail</i></button>' +
            '<button class="cui-btn cui-btn-sm btn-call"><i class="cui-icon">phone</i></button>' +
            '<button class="cui-btn cui-btn-sm btn-more"><i class="cui-icon">more_vert</i></button>' +
          '</div>' +
        '</div>';
      } else {
        return '<div class="contact-card" data-id="' + c.id + '">' +
          '<div class="contact-avatar" style="background:' + c.color + ';">' + initials + '</div>' +
          '<div class="contact-main">' +
            '<div style="min-width:150px;"><div class="contact-name">' + c.name + '<span class="contact-status ' + c.status + '"></span></div>' +
            '<div class="contact-role">' + c.role + '</div></div>' +
            '<div class="contact-info">' +
              '<div class="contact-info-item"><i class="cui-icon">business</i>' + c.dept + '</div>' +
              '<div class="contact-info-item"><i class="cui-icon">email</i>' + c.email + '</div>' +
              '<div class="contact-info-item"><i class="cui-icon">phone</i>' + c.phone + '</div>' +
            '</div>' +
          '</div>' +
          '<div class="contact-actions">' +
            '<button class="cui-btn cui-btn-sm cui-btn-primary btn-message"><i class="cui-icon">mail</i></button>' +
            '<button class="cui-btn cui-btn-sm btn-call"><i class="cui-icon">phone</i></button>' +
            '<button class="cui-btn cui-btn-sm btn-more"><i class="cui-icon">more_vert</i></button>' +
          '</div>' +
        '</div>';
      }
    }).join('');

    var grid = document.getElementById('contactGrid');
    grid.className = viewMode === 'grid' ? 'contact-grid' : 'contact-list';
    grid.innerHTML = html || '<div class="cui-text-center cui-text-secondary cui-p-20">검색 결과가 없습니다.</div>';
  }

  renderContacts();

  // 검색
  bindEvent('#searchInput', 'input', function(e){
    searchText = e.target.value;
    renderContacts();
  });

  // 부서 필터
  bindEvent('#deptFilter', 'change', function(e){
    deptFilter = e.target.value;
    renderContacts();
  });

  // 뷰 모드 전환
  bindEvent('#viewGrid', 'click', function(){
    viewMode = 'grid';
    renderContacts();
  });

  bindEvent('#viewList', 'click', function(){
    viewMode = 'list';
    renderContacts();
  });

  // 연락처 추가
  bindEvent('#btnAddContact', 'click', function(){
    popup.msg('연락처 추가 기능은 준비 중입니다');
  });

  // 카드 버튼 이벤트 (이벤트 위임)
  document.getElementById('contactGrid').addEventListener('click', function(e){
    var btn = e.target.closest('button');
    if(!btn) return;
    
    var card = btn.closest('.contact-card');
    var id = parseInt(card.getAttribute('data-id'));
    var contact = contacts.find(function(c){ return c.id === id; });
    
    if(btn.classList.contains('btn-message')){
      popup.msg(contact.name + '님에게 메시지 보내기');
    } else if(btn.classList.contains('btn-call')){
      popup.msg(contact.phone + '로 전화 걸기');
    } else if(btn.classList.contains('btn-more')){
      dropdown.render({
        elem: btn,
        data: [
          { title: '프로필 보기', icon: 'person' },
          { title: '수정', icon: 'edit' },
          { title: '삭제', icon: 'delete' }
        ],
        click: function(data){
          popup.msg(contact.name + ' - ' + data.title);
        }
      });
    }
  });
});
</script>
